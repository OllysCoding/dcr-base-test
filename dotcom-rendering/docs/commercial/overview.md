# Commercial overview

This document aims to describe the client-side commercial code in Dotcom Rendering.

Commercial code relates to:

- Serving ads
- Tracking related to ads

We load a single commercial script, `dotcom-rendering-commercial.js`, as a high-priority item in the head (preload). The script is generated by frontend and performs the same loading of commercial modules as the classical `commercial.js` init script.

Among other tasks performed by the commercial modules we have

- Consent management
- Place dynamic ad slots
- Populate ad slots (dynamic and static ones)
- Load tracking scripts (such as Lotame)

## Ad slots and components

- Static ads (banner, top-right, most-viewed)
- Dynamic (in-body) ads
- Mechandising slots (such as masterclass below-content onward component)

## Advertizing eco-system

To introduce some terms, we use:

- [Prebid](https://prebid.org/overview/intro.html), for [header-bidding](https://digiday.com/media/wtf-header-bidding/)
- [Google Ad Manager](https://en.wikipedia.org/wiki/Google_Ad_Manager)
- [Ozone](https://www.ozoneproject.com/advertisers) an ad platform launched by a consortium of UK newspapers, including the Guardian

## Tracking

- [Krux](https://www.salesforce.com/products/marketing-cloud/data-management), a Salesforce tracking and audience segmentation solution
- [Lotame](https://www.lotame.com/)

There are several more trackers on the site. A good way to visualise these is: [http://requestmap.webperf.tools/](http://requestmap.webperf.tools/).

## Development change checklist

Currently we do not have good automated tests covering the commercial stack in dotcom-rdnering. Once your change is ready, and depending on the nature of the change, here are the things you might want to have a look at. 

- Are the ad slots loading normaly when visually checking a page. Check the static slots as well as the inbody dynamic ones.
- Are there any obvious console errors?
- The Data & Insight team, can identify any widespread anomolies. Usually with a lag of a day or more.
- Is Lotame segmentation working? (instructions coming soon)
- Is Krux segmentation working? (instructions coming soon)
